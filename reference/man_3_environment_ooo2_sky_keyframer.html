---
title: 3.1 The Sky Keyframer
layout: reference
url: 3.1 The Sky Keyframer
---
<!-- HTML header for doxygen 1.8.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>trueSKY: 3.1 The Sky Keyframer</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">3.1 The Sky Keyframer </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><h2>Updating </h2>
<p>An instance of <a class="el" href="classsimul_1_1sky_1_1SkyKeyframer.html">SkyKeyframer</a> is stored in <a class="el" href="classsimul_1_1clouds_1_1Environment.html">simul::clouds::Environment</a>. As a keyframer, this class stores a list of keyframes; this list can be modified at runtime, or loaded from a sequence (see sequencer).</p>
<p>The keyframes each have a <em>time</em> value, and the keyframer tracks a current time through these frames, interpolating properties as it does so.</p>
<p>The SkyKeyframer has two modes of operation. By switching <a class="el" href="classsimul_1_1sky_1_1SkyKeyframer.html#a023aa5b3c4c314c2360edd009d54f641">LinkKeyframeTimeAndDaytime</a> on or off, you can choose whether the keyframes have a daytime value which is independent of <em>time</em>, or whether these two numbers are the same.</p>
<p>You don't need to update the keyframer specifically, so long as you're calling <a class="el" href="classsimul_1_1clouds_1_1Environment.html#aa7b19b8ebc85d3a60ea245d9eac1fcf2">environment-&gt;Update()</a>.</p>
<h2>Linked Time and Daytime </h2>
<p>If they are linked, <a class="el" href="structsimul_1_1sky_1_1BaseKeyframe.html#a8090c3824cb8b2b3f62be0309d3c2574">time</a> and <a class="el" href="structsimul_1_1sky_1_1SkyKeyframe.html#aa2e71e97bce93e87dbe95180c23abe46">daytime </a> will be the same number, where 0 represents the first midnight of the sequence, 1.0 represents 24 hours after this, and so on.</p>
<div class="image">
<img src="SkyKeyframerLinked.png" alt="SkyKeyframerLinked.png"/>
</div>
<p> Here we enable this link by calling SetLinkKeyframeTimeAndDaytime, then verify that daytime and time are now the same: </p><pre class="fragment">simul::sky::SkyKeyframer *sk=environment-&gt;skyKeyframer;
sk-&gt;SetLinkKeyframeTimeAndDaytime(true);
for(int i=0;i&lt;sk-&gt;GetNumKeyframes();i++)
{
    simul::sky::SkyKeyframe *k=(simul::sky::SkyKeyframe *)sk-&gt;GetKeyframe(i);
    assert(k-&gt;daytime==k-&gt;time);
}
</pre><h2>Unlinked Time and Daytime </h2>
<p>If they are not linked, then while daytime is defined as above, the keyframe's <a class="el" href="structsimul_1_1sky_1_1BaseKeyframe.html#a8090c3824cb8b2b3f62be0309d3c2574">time</a> value is arbitrary - it could represent the real time in seconds, or some other scale. Furthermore, while the keyframes will be sorted so that they are in ascending order of <a class="el" href="structsimul_1_1sky_1_1BaseKeyframe.html#a8090c3824cb8b2b3f62be0309d3c2574">time</a>, daytime will have no such restriction. You could have a midday keyframe, followed by sunset, followed by midday again. Here, we set all the keyframes to be at daytime=0.25 (6am): </p><pre class="fragment">simul::sky::SkyKeyframer *sk=environment-&gt;skyKeyframer.Get();
sk-&gt;SetLinkKeyframeTimeAndDaytime(false);
for(int i=0;i&lt;sk-&gt;GetNumKeyframes();i++)
{
    simul::sky::SkyKeyframe *k=(simul::sky::SkyKeyframe *)sk-&gt;GetKeyframe(i);
    k-&gt;daytime=0.25f;
}
</pre><p>You could also disable <a class="el" href="">AutomaticSunPosition</a>, in which case daytime will have no effect on sun position.</p>
<p>The unlinked time mode is particularly suitable to situations where you will use the Simul API to change conditions on the fly. At any given time, two keyframes are being used for rendering, and the next one along will be partially updated. So the properties of the fourth keyframe can be changed without having any need for recalculations. </p><pre class="fragment">simul::sky::SkyKeyframe *k=environment-&gt;skyKeyframer-&gt;GetNextModifiableKeyframe();
k-&gt;haze=20.f;
</pre><p>This works just as well with linked as with unlinked times.</p>
<h2>Properties of a Sky Keyframe </h2>
<p>For a complete list of a sky keyframe's properties, see <a class="el" href="structsimul_1_1sky_1_1SkyKeyframe.html">SkyKeyframe</a>.</p>
<table class="doxtable">
<tr>
<td>float daytime</td><td>The time this keyframe represents, in a floating-point number of days from the starting midnight of the sequence. If <a class="el" href="classsimul_1_1sky_1_1SkyKeyframer.html#a023aa5b3c4c314c2360edd009d54f641">simul::sky::SkyKeyframer::SetLinkKeyframeTimeAndDaytime</a> is true, this is the same as the keyframe's time value.  </td></tr>
<tr>
<td>float4 Mie</td><td>The Mie scattering coefficients (x=red,y=green,z=blue). </td></tr>
<tr>
<td>bool AutoMie</td><td>The Mie scattering coefficients will be calculated based on wavelength and haze if this is set - overrides Mie. </td></tr>
<tr>
<td>float Haze</td><td>The amount of haze, mist or fog. </td></tr>
<tr>
<td>float HazeBaseKm</td><td>The base altitude, above which haze starts to decrease in density. </td></tr>
<tr>
<td>float HazeScaleKm</td><td>The vertical scale over which haze reduces with altitude. </td></tr>
<tr>
<td>float HazeEccentricity</td><td>The anisotropy of Mie scattering. </td></tr>
<tr>
<td>float SunAzimuth</td><td>Horizontal angle to the sun. This will be overridden if sun position is automatic. </td></tr>
<tr>
<td>float SunElevation</td><td>Angle of the sun above the horizon. This will be overridden if sun position is automatic. </td></tr>
<tr>
<td>float MoonElevation</td><td>Angle of the moon above the horizon. This will be overridden if moon position is automatic. </td></tr>
<tr>
<td>float MoonAzimuth</td><td>Horizontal angle to the moon. This will be overridden if moon position is automatic. </td></tr>
</table>
<p>These are public properties of the structure. You can set any property of any keyframe at any time. But setting properties of active keyframes causes recalculation, which will interrupt the program for a short time, so it is recommended not to do this frequently outside of tools and testing.</p>
<p>To ensure that no recalculation takes place, the function <a class="el" href="classsimul_1_1sky_1_1SkyKeyframer.html#ae2f940bd5aa799a2a75372160a38c286">GetNextModifiableKeyframe()</a> can be used to get a pointer to the keyframe after those currently being interpolated or used for table-generation. You can change its properties freely.</p>
<p>A keyframe's haze value determines how much Mie-scattered haze (i.e. mist or fog) is present. Haze is considered to have a density that falls-off exponentially with altitude, so the HazeScaleHeightKm property determines the scaling height for this exponential. The HazeBaseHeightKm is also used. Below this height, full haze is applied.</p>
<p>Fog and mist are both effectively low-level clouds. Fog is defined as having visibility less than 1km, it is called mist when visibility is between 1 and 2 km.</p>
<p>As time passes and the sun and moon move, you can use <a class="el" href="classsimul_1_1sky_1_1BaseSkyInterface.html#ad21cc06e29b47fc60130059b4eda53cf">GetDirectionToSun</a> and <a class="el" href="classsimul_1_1sky_1_1BaseSkyInterface.html#ad35e1d646de0c43772d1ed3fd55efbe4">simul::sky::BaseSkyInterface::GetDirectionToMoon</a> to find their positions.</p>
<hr/>
<p> Next: <a class="el" href="man_3_environment_ooo2_cloud_keyframer.html">3.2 The Cloud Keyframer</a> </p>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.9.1-->
<!-- start footer part -->
<hr class="footer"/>
<address style="text-align: right;">trueSKY VERSION 3.8.2<small>
Sat Apr 30 2016 07:49:12</small></address>
</body>
</html>
