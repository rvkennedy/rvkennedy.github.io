---
title: Simul/PRODUCTS/TrueSky/Help/3.2 CloudKeyframer.md Source File
layout: reference
url: Simul/PRODUCTS/TrueSky/Help/3.2 CloudKeyframer.md Source File
---
<!-- HTML header for doxygen 1.8.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.10"/>
<title>trueSKY: Simul/PRODUCTS/TrueSky/Help/3.2 CloudKeyframer.md Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.10 -->
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Simul/PRODUCTS/TrueSky/Help/3.2 CloudKeyframer.md</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;3.2 The Cloud Keyframer    {#man_3_environment_ooo2_cloud_keyframer}</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;========</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;Updating</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;--------</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;Two instances of CloudKeyframer are stored in simul::clouds::Environment - one for 3D volumetric clouds and one for 2D high-altitude clouds.</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;As a keyframer, this class stores a list of keyframes; this list can be modified at runtime, or loaded from a sequence (see \ref sequencer).</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;The keyframes each have a \a time value, and the keyframer tracks a current time through these frames, interpolating properties as it does so, into a special keyframe.</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;You can be obtain a reference to this using \link simul::clouds::CloudKeyframer::GetInterpolatedKeyframe() GetInterpolatedKeyframe()\endlink.</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;The cloud keyframer is updated from \link simul::clouds::Environment Environment\endlink.</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;Some \link simul::clouds::CloudKeyframe cloud keyframe\endlink properties are used as per-keyframe values to generated the 3D or 2D cloud textures.</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;These textures are then interpolated for rendering:</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;- cloudiness</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;- distribution_base_layer</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;- distribution_transition</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;- upper_density</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;- cloud_height_km</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;- octaves</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;- persistence</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;- extinction</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;- diffusivity</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;- masks</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;Some are used as interpolated values per-frame when rendering, either to determine the geometry of the clouds:</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;- wind_speed</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;- wind_direction</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;- cloud_base_km</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;- cloud_height_km</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;- cloud_width_km</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;- offsetx</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;- offsety</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;or the visual cloud properties:</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;- direct_light</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;- indirect_light</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;- ambient_light</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;- light_asymmetry</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;- fractal_amplitude</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;- fractal_wavelength</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;- edge_sharpness</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;- churn</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;- base_noise_factor</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;While others are used to inform different parts of the rendering system:</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;- precipitation</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;- rain_to_snow</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;- lightning</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;- godray_strength</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;Cloud Volume Size</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;------------</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;By default, the cloud volume repeats at the edges, and the volume width is controlled by the keyframe cloud_width_km value.</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;You can change the size of this volume freely, but to increase the size while retaining the same level of detail, you will also need to modify the size of the volumetric grid.</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;For example, to double the size of the volume, select all the 3D cloud keyframes, and double the size of cloud_width_km. Select the cloud layer, and increase both the Cloud Grid Width, and the Generation Noise Resolution, by a factor of two.</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;Fine Control</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;------------</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;The cloud shape can be controlled using the keyframe properties \link simul::clouds::CloudKeyframe::distribution_base_layer distribution_base_layer\endlink,</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;\link simul::clouds::CloudKeyframe::distribution_transition distribution_transition\endlink and</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;\link simul::clouds::CloudKeyframe::upper_density upper_density\endlink.</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;Local Cloud Cells</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;------------</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;\em Clouds can be positioned precisely using the masking feature of cloud keyframes.</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;To position clouds, disable horizontal wrapping and enable explicit offsets, so that the cloud volume can be positioned</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;per-keyframe:</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;   environment-&gt;cloudKeyframer-&gt;SetExplicitOffsets(true);</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;   environment-&gt;cloudKeyframer-&gt;GetCloudInterface()-&gt;SetWrap(false);</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;e.g. to position the fourth keyframe of the cloudKeyframer:</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;   simul::clouds::CloudKeyframe *K=environment-&gt;cloudKeyframer-&gt;GetKeyframe(3);</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;   K-&gt;offsetx=10000.f;</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;   K-&gt;offsety=10000.f;</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;Within the cloud volume, the \em masks determine where clouds are present at any horizontal position. </div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;Each keyframe has an optional list of masks, and each mask has an xy position, and a radius, in units where 1.0 is</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;the width of the volume. Each mask has a thickness, from 0 to 1.0, which acts as a multiplier to the local humidity (i.e. cloudiness).</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;The mask list is a \em map, with an integer key. For example, to modify keyframe K, we can create or change the mask with id 7:</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;   simul::clouds::Mask &amp;M=K-&gt;masks[7];</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;   M.x=0.5f;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;   M.y=0.6f;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;   M.radius=0.3f;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;   M.thickness=1.0f;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;To remove a mask from a keyframe:</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;   K-&gt;masks.erase(7);</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;&lt;hr&gt;</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;Next: \ref man_4_rendering</div>
</div><!-- fragment --></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.9.1-->
<!-- start footer part -->
<hr class="footer"/>
<address style="text-align: right;">trueSKY VERSION 3.8.2<small>
Thu Feb 11 2016 07:46:29</small></address>
</body>
</html>
