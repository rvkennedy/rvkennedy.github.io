---
title: 3 Rendering the Environment
layout: reference
url: 3 Rendering the Environment
---
<!-- HTML header for doxygen 1.8.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>trueSKY: 3 Rendering the Environment</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">3 Rendering the Environment </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>All Simul's default renderers use a right-handed co-ordinate system with x pointing East, y North, and z up. All units of distance are metres or kilometres. If not specified as km, distance is in metres. Angular units are radians, unless specified as degrees. Temperature is in kelvins, unless specified as degrees Celsius.</p>
<p>Weather Rendering is handled by <a class="el" href="classsimul_1_1clouds_1_1BaseWeatherRenderer.html">BaseWeatherRenderer</a>.</p>
<p>The Weather Renderer owns and manages renderers for sky, clouds, atmospherics and other effects. So the Weather Renderer is the main interface between your program and trueSKY.</p>
<p>The following table describes the elements of a sky as implemented in the supplied renderers:</p>
<table class="doxtable">
<tr>
<th>Feature  </th></tr>
<tr>
<td>Cosmic Background </td></tr>
<tr>
<td>Stars </td></tr>
<tr>
<td>Planets </td></tr>
<tr>
<td>Volumetric Clouds </td></tr>
<tr>
<td>2D Clouds </td></tr>
<tr>
<td>Mixed resolution rendering </td></tr>
<tr>
<td>Atmospherics </td></tr>
<tr>
<td>Godrays </td></tr>
<tr>
<td>Precipitation </td></tr>
<tr>
<td>Rain streaks </td></tr>
</table>
<h2>Cosmic Background </h2>
<p>The cosmic background texture is drawn first, at an orientation that corresponds to the plane of the Milky Way galaxy - see <a class="el" href="classsimul_1_1sky_1_1SkyKeyframer.html#a028832b8b1bb2d2d314000aa6c8763ab">BackgroundBrightness</a>.</p>
<p>It uses a plate-carree projection, aligned with the galactic horizon. Given the vector "view", which is the direction in galactic co-ordinates, the calculation is: </p><pre class="fragment">float az       =atan2(view.y,-view.x);
vec2 texcoord  =vec2((ang/(pi*2.0)),0.5-asin(view.z)/pi);
</pre><p>i.e. the x coordinate is proportional to the azimuth, and the y coordinate is proportional to the elevation</p>
<div class="image">
<img src="MilkyWay.png" alt="MilkyWay.png"/>
</div>
<p> You may see some stretching at the top and bottom of the image due to degeneracy of the projection, so it is preferable to have the texture fade to black at the top and bottom edges.</p>
<h2>Stars </h2>
<p>Stars are drawn as points, and spun around the axis of the Earth's rotation, in the same direction as the sun. Stars are usually drawn to the highest-resolution buffer (i.e. the frame buffer or final buffer). See <a class="el" href="classsimul_1_1sky_1_1SkyKeyframer.html#aca72f191a74c77fd8482695b3b129b06">StarBrightness</a> and <a class="el" href="classsimul_1_1sky_1_1SkyKeyframer.html#aee0d91276a44a95e5f4e5182e1f4e135">MaxStarMagnitude</a>.</p>
<h2>The Sun </h2>
<p>The sun is drawn after the stars.</p>
<h2>Planets </h2>
<p>Planets (e.g. the Moon) are drawn by BaseSkyRenderer. A planet texture map needs to be supplied, and the shader takes a sun direction as a parameter - this is used to light the planet (e.g. phases of the moon). Like stars, planets are usually drawn to the highest-resolution buffer, in order to make sure they have sharp outlines.</p>
<h2>Sky/Atmospherics </h2>
<p>The sky and atmospherics are drawn to a volumetric texture for which the x and y axes are screen coordinates, and the z axis is distance. The final compositing step puts the sky, atmospherics and clouds to the current rendertarget.</p>
<h2>Clouds </h2>
<p>Clouds are usually drawn to a pair of lower-resolution buffers. The <a class="el" href="classsimul_1_1clouds_1_1BaseCloudRenderer.html">BaseCloudRenderer</a> keeps the cloud volume textures up to date, and draws the clouds volumetrically.</p>
<h2>Performance </h2>
<p>Rendering performance is chiefly dependent on the number of pixels drawn, and the number of raycasting steps (or Cloud Slices). Calculation performance - mainly cloud lighting - depends strongly on the grid size - the larger the grid, the more time will be taken to light a cloud keyframe.</p>
<p>To adjust the number of drawn layers, the <a class="el" href="classsimul_1_1clouds_1_1CloudKeyframer.html">simul::clouds::CloudKeyframer</a> class offers the maximum distance (in kilometres) with <a class="el" href="">SetMaxCloudDistanceKm</a> and BaseCloudRenderer has the maximum number of layers (<a class="el" href="classsimul_1_1clouds_1_1BaseCloudRenderer.html#a1a2b33830fe844543c5fafdc2948c842">SetMaxSlices</a>) functions.</p>
<p>It is usual to downsample the cloud part of the sky rendering to 1/2 or 1/4 resolution. This is controlled by <a class="el" href="classsimul_1_1clouds_1_1BaseWeatherRenderer.html#a624ec44f492aad4084b0be23db1178fb">SetDefaultDownscale</a> in the <a class="el" href="classsimul_1_1clouds_1_1BaseWeatherRenderer.html">weather renderer</a>.</p>
<h2>Rain and Snow </h2>
<div class="image">
<img src="rain.jpg" alt="rain.jpg"/>
</div>
<p> The <a class="el" href="structsimul_1_1clouds_1_1CloudKeyframe.html#a0a5a9c5304551568bc287477cacceedc">precipitation</a> is used to control the amount of rain or snowfall at a given time, whilst the <a class="el" href="classsimul_1_1clouds_1_1CloudKeyframer.html">PrecipitationThresholdKm</a> property is used to set the thickness of cloud required for rain to fall (setting this to 0 will allow even the smallest of clouds to produce rain). To switch between snow and rain use <a class="el" href="structsimul_1_1clouds_1_1CloudKeyframe.html">rain_to_snow</a> (where 0 is rain, 1 is snow).</p>
<p>Each cloud keyframe has a <a class="el" href="structsimul_1_1clouds_1_1PrecipitationRegion.html">PrecipitationRegion</a>, which defines the local area of precipitation, if it is not global for the keyframe. The amount of particles used for precipitation can be altered with the <a class="el" href="classsimul_1_1clouds_1_1BasePrecipitationRenderer.html">MaxParticles</a> property.</p>
<div class="image">
<img src="Lightning-RainStreaks.jpg" alt="Lightning-RainStreaks.jpg"/>
</div>
<p> Classes derived from <a class="el" href="classsimul_1_1clouds_1_1BasePrecipitationRenderer.html" title="The class that renders rain and snow. ">simul::clouds::BasePrecipitationRenderer</a> are used to draw the rain or snow particles, while the <a class="el" href="structsimul_1_1clouds_1_1PrecipitationRegion.html">rain streak effect</a> is drawn by the cloud renderer. This class has a property "UseSimulationTime" which determines whether rain and snow speed is based on the simulated time-of-day, or real time in seconds.</p>
<h2>Shaders </h2>
<p>Shaders are provided as source in the shader subdirectories of the platform directories (see <a class="el" href="man_5_classes_ooo2_shaders.html">5.2 Shaders</a>).</p>
<hr/>
<p> Next: <a class="el" href="man_4_pri.html">4 The Plugin Rendering Interface</a> </p>
</div></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.9.1-->
<!-- start footer part -->
<hr class="footer"/>
<address style="text-align: right;">trueSKY VERSION SIMUL_MAJOR_VERSION=4.0.0<small>
Mon Jan 2 2017 07:54:26</small></address>
</body>
</html>
