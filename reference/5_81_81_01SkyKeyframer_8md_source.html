---
title: Simul/PRODUCTS/TrueSky/Help/5.1.1 SkyKeyframer.md Source File
layout: reference
url: Simul/PRODUCTS/TrueSky/Help/5.1.1 SkyKeyframer.md Source File
---
<!-- HTML header for doxygen 1.8.9.1-->
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.11"/>
<title>trueSKY: Simul/PRODUCTS/TrueSky/Help/5.1.1 SkyKeyframer.md Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.11 -->
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Simul/PRODUCTS/TrueSky/Help/5.1.1 SkyKeyframer.md</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;3.1 The Sky Keyframer {#man_5_classes_ooo1_environment_ooo1_sky_keyframer}</div><div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;=================</div><div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;</div><div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;Updating</div><div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;--------</div><div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;An instance of \link simul::sky::SkyKeyframer SkyKeyframer\endlink is stored in simul::clouds::Environment. As a keyframer, this class</div><div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;stores a list of keyframes; this list can be modified at runtime, or loaded from a sequence (see \ref man_6_sequencer).</div><div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div><div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;The keyframes each have a \a time value, and the keyframer tracks a current time through these frames, interpolating properties as it does so.</div><div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;</div><div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;The SkyKeyframer has two modes of operation. By switching \link simul::sky::SkyKeyframer::SetLinkKeyframeTimeAndDaytime LinkKeyframeTimeAndDaytime\endlink on or off,</div><div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;you can choose whether the keyframes have a daytime value which is independent of \a time, or whether these two numbers are the same.</div><div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;</div><div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;You don&#39;t need to update the keyframer specifically, so long as you&#39;re calling \link simul::clouds::Environment::Update environment-&gt;Update()\endlink.</div><div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;</div><div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;Linked Time and Daytime</div><div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;-----------------------</div><div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;</div><div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;If they are linked, \link simul::sky::BaseKeyframe::time time\endlink and \link simul::sky::SkyKeyframe::daytime daytime \endlink</div><div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;will be the same number, where 0 represents the first midnight of the sequence, 1.0 represents 24 hours after this, and so on.</div><div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div><div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;\image html &quot;SkyKeyframerLinked.png&quot; &quot;&quot;</div><div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;</div><div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;Here we enable this link by calling SetLinkKeyframeTimeAndDaytime, then verify that daytime and time are now the same:</div><div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div><div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;   simul::sky::SkyKeyframer *sk=environment-&gt;skyKeyframer;</div><div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;   sk-&gt;SetLinkKeyframeTimeAndDaytime(true);</div><div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;   for(int i=0;i&lt;sk-&gt;GetNumKeyframes();i++)</div><div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;   {</div><div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;       simul::sky::SkyKeyframe *k=(simul::sky::SkyKeyframe *)sk-&gt;GetKeyframe(i);</div><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;       assert(k-&gt;daytime==k-&gt;time);</div><div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;   }</div><div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;</div><div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;</div><div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;Unlinked Time and Daytime</div><div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;-------------------------</div><div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div><div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;If they are not linked, then while daytime is defined as above, the keyframe&#39;s \link simul::sky::BaseKeyframe::time time\endlink</div><div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;value is arbitrary - it could represent the real time in seconds, or some other scale. Furthermore, while the keyframes</div><div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;will be sorted so that they are in ascending order of \link simul::sky::BaseKeyframe::time time\endlink,</div><div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;daytime will have no such restriction. You could have a midday keyframe, followed by sunset, followed by midday again.</div><div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;Here, we set all the keyframes to be at daytime=0.25 (6am):</div><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;</div><div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;   simul::sky::SkyKeyframer *sk=environment-&gt;skyKeyframer.Get();</div><div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;   sk-&gt;SetLinkKeyframeTimeAndDaytime(false);</div><div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;   for(int i=0;i&lt;sk-&gt;GetNumKeyframes();i++)</div><div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;   {</div><div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;       simul::sky::SkyKeyframe *k=(simul::sky::SkyKeyframe *)sk-&gt;GetKeyframe(i);</div><div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;       k-&gt;daytime=0.25f;</div><div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;   }</div><div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;</div><div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;You could also disable \link simul::sky::SkyKeyframe::automaticSunPosition automaticSunPosition\endlink, in which case daytime will have no effect</div><div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;on sun position.</div><div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;</div><div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;The unlinked time mode is particularly suitable to situations where you will use the Simul API to change conditions on the fly.</div><div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;At any given time, two keyframes are being used for rendering, and the next one along will be partially updated. So the properties</div><div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;of the fourth keyframe can be changed without having any need for recalculations.</div><div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;</div><div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;   simul::sky::SkyKeyframe *k=environment-&gt;skyKeyframer-&gt;GetNextModifiableKeyframe();</div><div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;   k-&gt;haze=20.f;</div><div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;</div><div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;This works just as well with linked as with unlinked times.</div><div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div><div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;</div><div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;Properties of a Sky Keyframe</div><div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;-------------------------</div><div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;</div><div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;For a complete list of a sky keyframe&#39;s properties, see \link simul::sky::SkyKeyframe SkyKeyframe\endlink.</div><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;</div><div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;&lt;table&gt;</div><div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;&lt;tr&gt;&lt;td&gt;float daytime&lt;/td&gt;&lt;td&gt;The time this keyframe represents, in a floating-point number of days from the starting midnight of the sequence. If simul::sky::SkyKeyframer::SetLinkKeyframeTimeAndDaytime is true, this is the same as the keyframe&#39;s time value.&lt;/td&gt;</div><div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;&lt;/tr&gt;</div><div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;&lt;tr&gt;&lt;td&gt;float4 Mie&lt;/td&gt;&lt;td&gt;The Mie scattering coefficients (x=red,y=green,z=blue).&lt;/td&gt;&lt;/tr&gt;</div><div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;&lt;tr&gt;&lt;td&gt;bool AutoMie&lt;/td&gt;&lt;td&gt;The Mie scattering coefficients will be calculated based on wavelength and haze if this is set - overrides Mie.&lt;/td&gt;&lt;/tr&gt;</div><div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;&lt;tr&gt;&lt;td&gt;float Haze&lt;/td&gt;&lt;td&gt;The amount of haze, mist or fog.&lt;/td&gt;&lt;/tr&gt;</div><div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;&lt;tr&gt;&lt;td&gt;float HazeBaseKm&lt;/td&gt;&lt;td&gt;The base altitude, above which haze starts to decrease in density.&lt;/td&gt;&lt;/tr&gt;</div><div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;&lt;tr&gt;&lt;td&gt;float HazeScaleKm&lt;/td&gt;&lt;td&gt;The vertical scale over which haze reduces with altitude.&lt;/td&gt;&lt;/tr&gt;</div><div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;&lt;tr&gt;&lt;td&gt;float HazeEccentricity&lt;/td&gt;&lt;td&gt;The anisotropy of Mie scattering.&lt;/td&gt;&lt;/tr&gt;</div><div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;&lt;tr&gt;&lt;td&gt;float SunAzimuth&lt;/td&gt;&lt;td&gt;Horizontal angle to the sun. This will be overridden if sun position is automatic.&lt;/td&gt;&lt;/tr&gt;</div><div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;&lt;tr&gt;&lt;td&gt;float SunElevation&lt;/td&gt;&lt;td&gt;Angle of the sun above the horizon. This will be overridden if sun position is automatic.&lt;/td&gt;&lt;/tr&gt;</div><div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;&lt;tr&gt;&lt;td&gt;float MoonElevation&lt;/td&gt;&lt;td&gt;Angle of the moon above the horizon. This will be overridden if moon position is automatic.&lt;/td&gt;&lt;/tr&gt;</div><div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;&lt;tr&gt;&lt;td&gt;float MoonAzimuth&lt;/td&gt;&lt;td&gt;Horizontal angle to the moon. This will be overridden if moon position is automatic.&lt;/td&gt;&lt;/tr&gt;</div><div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;&lt;/table&gt;</div><div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;</div><div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;These are public properties of the structure. You can set any property of any keyframe at any time.</div><div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;But setting properties of active keyframes causes recalculation, which will interrupt the program for a short time,</div><div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;so it is recommended not to do this frequently outside of tools and testing.</div><div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div><div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;To ensure that no recalculation takes place, the function \link simul::sky::SkyKeyframer::GetNextModifiableKeyframe GetNextModifiableKeyframe()\endlink</div><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;can be used to get a pointer to the keyframe after those currently being interpolated or used for table-generation.</div><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;You can change its properties freely.</div><div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160; </div><div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;A keyframe&#39;s haze value determines how much Mie-scattered haze (i.e. mist or fog) is present. Haze is considered to have a density that falls-off</div><div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160; exponentially with altitude, so the HazeScaleHeightKm property determines the scaling height for this exponential. The</div><div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160; HazeBaseHeightKm is also used. Below this height, full haze is applied.</div><div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div><div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;Fog and mist are both effectively low-level clouds. Fog is defined as having visibility less than 1km, it is called mist when visibility</div><div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160; is between 1 and 2 km.</div><div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160; </div><div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;As time passes and the sun and moon move, you can use \link simul::sky::BaseSkyInterface::GetDirectionToSun GetDirectionToSun\endlink and \link simul::sky::BaseSkyInterface::GetDirectionToMoon\endlink to find their positions.</div><div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160; </div><div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;&lt;hr size=&quot;1&quot;&gt;</div><div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;Next: \ref man_5_classes_ooo1_environment_ooo2_cloud_keyframer</div></div><!-- fragment --></div><!-- contents -->
<!-- HTML footer for doxygen 1.8.9.1-->
<!-- start footer part -->
<hr class="footer"/>
<address style="text-align: right;">trueSKY VERSION SIMUL_MAJOR_VERSION=4.0.0<small>
Thu Feb 2 2017 07:54:57</small></address>
</body>
</html>
